"use strict";

var Module = function ($) {

    function _getUrl() {
        var query = location.search.substr(1);
        var result = {};

        query.split("&").forEach(function (part) {
            var item = part.split("=");
            result[item[0]] = decodeURIComponent(item[1]);
        });

        return result;
    }

    function _setUrl(name, parameter) {
        var _url = _getUrl();

        _url[name] = parameter;

        return _url;
    }

    function _joinUrl(get) {
        var url = [];

        Object.keys(get).map(function (id) {
            if (get[id] !== 'undefined' && get[id] !== '') {
                url.push([id, get[id]].join('='));
            }
        });

        return url.join('&');
    }

    function _redirectUrl(get) {
        if (Object.keys(get).length) {
            var url = '';

            Object.keys(get).map(function (id) {
                if (id !== 'page' && get[id] !== 'undefined' && get[id] !== '') {
                    if (url !== '') {
                        url += '&';
                    }

                    url += [id, get[id]].join('=');
                }
            });

            location.search = url;
        }
    }

    return {

        changeFileName: function changeFileName(id, title) {
            console.log('ed', id, title);

            if (typeof id !== 'undefined' && typeof title !== 'undefined') {
                var name = prompt('Введите новое имя', title);

                if (name !== '' && name !== title && name !== null) {
                    $.ajax({
                        url: "/" + ADMIN_DIR + "/meta/filename",
                        type: 'POST',
                        data: {
                            id: id,
                            name: name
                        }
                    });

                    return name;
                }
            }

            return false;
        },

        ajaxFileDelete: function ajaxFileDelete(id, obj) {
            if (cp.dialog("Вы дейсвительно хотите удалить файл?")) {
                $.ajax({
                    url: '/' + ADMIN_DIR + '/meta/filedelete',
                    type: "post",
                    data: {
                        id: id
                    },
                    dataType: 'JSON',
                    success: function success(response) {
                        console.log(response);

                        if (response.status === true) {
                            $('#' + obj).remove();
                        }
                    }
                });
            }

            return false;
        },

        sort: function sort(name) {
            var _get = _getUrl();

            if (typeof _get.sort !== 'undefined') {
                var type = _get.sort.split('-')[1];
                type = type === 'asc' ? 'desc' : 'asc';
                location.search = _joinUrl(_setUrl('sort', name + '-' + type));
            } else {
                location.search = _joinUrl(_setUrl('sort', name + '-asc'));
            }
        },
        search: function search(name, value, bind, e) {
            if (bind) {
                if (e.keyCode == 13) {
                    _redirectUrl(_setUrl(name, value));
                }
            } else {
                _redirectUrl(_setUrl(name, value));
            }
        },
        reload: function reload() {
            var _get = _getUrl();

            if (typeof _get.page !== 'undefined') {
                var prev = _get.page - 1 >= 0 ? _get.page - 1 : '';

                if (prev) {
                    location.search = 'page=' + prev;
                } else {
                    location.reload();
                }
            } else {
                location.reload();
            }
        },
        setSort: function setSort(element, id, field) {
            var name = ['module', 'sorted', id].join('_');
            var value = element.value;
            var cache = $.cookie(name);

            if (cache) {
                var sort = [];
                var temp = unserialize(cache);

                if (temp[id] == 'undefined') {
                    sort[id] = {};
                    sort[id][field] = value;
                } else {
                    if (temp[id][field] == 'undefined') {
                        temp[id][field] = value;
                    } else {
                        temp[id][field] = value;
                    }

                    sort = temp;
                }

                $.removeCookie(name);
                $.cookie(name, serialize(sort), { expires: 30, path: '/' });
            } else {
                var _sort = [];

                _sort[id] = {};
                _sort[id][field] = value;

                $.cookie(name, serialize(_sort), { expires: 30, path: '/' });
            }

            setTimeout(function () {
                location.reload();
            }, 50);
        },
        setLimit: function setLimit(element, id) {
            var name = ['module', 'limit', id].join('_');
            var limit = parseInt(element.value);

            $.removeCookie(name);
            $.cookie(name, limit, { expires: 30, path: '/' });

            setTimeout(function () {
                location.reload();
            }, 50);
        },
        update: function update(e, name, id) {
            var value = Number(e.target.checked);

            $.ajax({
                url: ['/', ADMIN_DIR, '/shopping/update'].join(''),
                type: "post",
                data: {
                    id: id,
                    name: name,
                    value: value
                },
                dataType: 'JSON',
                success: function success(response) {
                    console.log('update');
                }
            });
        },
        checkAll: function checkAll(element) {
            var checked = $(element).prop('checked');
            $('.check-all-spy').prop('checked', checked);

            if (checked) {
                $('#remove-button').addClass('enable');
            } else {
                $('#remove-button').removeClass('enable');
            }
        },
        checkItem: function checkItem(element) {
            if ($('.check-all-spy:checked').length) {
                $('#remove-button').addClass('enable');
            } else {
                $('#remove-button').removeClass('enable');
            }
        },
        deleteQuestion: function deleteQuestion(e, element) {
            e.preventDefault();

            var isDelete = cp.dialog('Вы действительно хотите удалить позицию?');

            if (isDelete) {
                var _href = $(element).attr('href');

                $.post(_href, function () {
                    cp.notify('Позиция удалена', 'info');
                    $(element).closest('tr').remove();
                });
            }

            return false;
        },
        deleteItem: function deleteItem(id, mid, notify) {
            $.ajax({
                url: "/" + ADMIN_DIR + "/meta/module/del/" + mid + "/" + id,
                type: "post",
                data: {
                    id: id,
                    module: mid
                },
                dataType: 'JSON',
                success: function success() {
                    $('#module-table').find('.module-table__row[data-id="' + id + '"]').remove();

                    if (notify) {
                        cp.notify('Позиция удалена', 'info');
                    }
                }
            });
        },
        deleteAll: function deleteAll(e) {
            e.preventDefault();

            var count = $('.check-all-spy:checked').length;
            var limit = $('.check-all-spy').length;

            if (count) {
                var _this = this;

                if (cp.dialog(['Вы действительно хотите удалить ', declOfNum(count, ['позиция', 'позиций', 'позиции']), '?'].join(''))) {
                    $('.check-all-spy:checked').each(function (k, element) {
                        var mix = $(element).val();
                        var tmp = mix.split('_');

                        _this.deleteItem(parseInt(tmp[0]), parseInt(tmp[1]), false);

                        if (k + 1 == count) {
                            cp.notify(['Удалено ', declOfNum(count, ['позиция', 'позиций', 'позиции'])].join(''), 'info');

                            setTimeout(function () {
                                if (count == limit) {
                                    _this.reload();
                                } else {
                                    location.reload();
                                }
                            }, 150);
                        }
                    });
                }
            }
        }
    };
}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6WyJNb2R1bGUiLCIkIiwiX2dldFVybCIsInF1ZXJ5IiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHIiLCJyZXN1bHQiLCJzcGxpdCIsImZvckVhY2giLCJwYXJ0IiwiaXRlbSIsImRlY29kZVVSSUNvbXBvbmVudCIsIl9zZXRVcmwiLCJuYW1lIiwicGFyYW1ldGVyIiwiX3VybCIsIl9qb2luVXJsIiwiZ2V0IiwidXJsIiwiT2JqZWN0Iiwia2V5cyIsIm1hcCIsImlkIiwicHVzaCIsImpvaW4iLCJfcmVkaXJlY3RVcmwiLCJsZW5ndGgiLCJjaGFuZ2VGaWxlTmFtZSIsInRpdGxlIiwiY29uc29sZSIsImxvZyIsInByb21wdCIsImFqYXgiLCJBRE1JTl9ESVIiLCJ0eXBlIiwiZGF0YSIsImFqYXhGaWxlRGVsZXRlIiwib2JqIiwiY3AiLCJkaWFsb2ciLCJkYXRhVHlwZSIsInN1Y2Nlc3MiLCJyZXNwb25zZSIsInN0YXR1cyIsInJlbW92ZSIsInNvcnQiLCJfZ2V0IiwidmFsdWUiLCJiaW5kIiwiZSIsImtleUNvZGUiLCJyZWxvYWQiLCJwYWdlIiwicHJldiIsInNldFNvcnQiLCJlbGVtZW50IiwiZmllbGQiLCJjYWNoZSIsImNvb2tpZSIsInRlbXAiLCJ1bnNlcmlhbGl6ZSIsInJlbW92ZUNvb2tpZSIsInNlcmlhbGl6ZSIsImV4cGlyZXMiLCJwYXRoIiwic2V0VGltZW91dCIsInNldExpbWl0IiwibGltaXQiLCJwYXJzZUludCIsInVwZGF0ZSIsIk51bWJlciIsInRhcmdldCIsImNoZWNrZWQiLCJjaGVja0FsbCIsInByb3AiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiY2hlY2tJdGVtIiwiZGVsZXRlUXVlc3Rpb24iLCJwcmV2ZW50RGVmYXVsdCIsImlzRGVsZXRlIiwiX2hyZWYiLCJhdHRyIiwicG9zdCIsIm5vdGlmeSIsImNsb3Nlc3QiLCJkZWxldGVJdGVtIiwibWlkIiwibW9kdWxlIiwiZmluZCIsImRlbGV0ZUFsbCIsImNvdW50IiwiX3RoaXMiLCJkZWNsT2ZOdW0iLCJlYWNoIiwiayIsIm1peCIsInZhbCIsInRtcCIsImpRdWVyeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxTQUFVLFVBQVNDLENBQVQsRUFBWTs7QUFFeEIsYUFBU0MsT0FBVCxHQUFtQjtBQUNmLFlBQU1DLFFBQVFDLFNBQVNDLE1BQVQsQ0FBZ0JDLE1BQWhCLENBQXVCLENBQXZCLENBQWQ7QUFDQSxZQUFNQyxTQUFTLEVBQWY7O0FBRUFKLGNBQU1LLEtBQU4sQ0FBWSxHQUFaLEVBQWlCQyxPQUFqQixDQUF5QixVQUFTQyxJQUFULEVBQWU7QUFDcEMsZ0JBQU1DLE9BQU9ELEtBQUtGLEtBQUwsQ0FBVyxHQUFYLENBQWI7QUFDQUQsbUJBQU9JLEtBQUssQ0FBTCxDQUFQLElBQWtCQyxtQkFBbUJELEtBQUssQ0FBTCxDQUFuQixDQUFsQjtBQUNILFNBSEQ7O0FBS0EsZUFBT0osTUFBUDtBQUNIOztBQUVELGFBQVNNLE9BQVQsQ0FBaUJDLElBQWpCLEVBQXVCQyxTQUF2QixFQUFrQztBQUM5QixZQUFNQyxPQUFPZCxTQUFiOztBQUVBYyxhQUFLRixJQUFMLElBQWFDLFNBQWI7O0FBRUEsZUFBT0MsSUFBUDtBQUNIOztBQUVELGFBQVNDLFFBQVQsQ0FBa0JDLEdBQWxCLEVBQXVCO0FBQ25CLFlBQU1DLE1BQU0sRUFBWjs7QUFFQUMsZUFBT0MsSUFBUCxDQUFZSCxHQUFaLEVBQWlCSSxHQUFqQixDQUFxQixjQUFNO0FBQ3ZCLGdCQUFJSixJQUFJSyxFQUFKLE1BQVksV0FBWixJQUEyQkwsSUFBSUssRUFBSixNQUFZLEVBQTNDLEVBQStDO0FBQzNDSixvQkFBSUssSUFBSixDQUFTLENBQUNELEVBQUQsRUFBS0wsSUFBSUssRUFBSixDQUFMLEVBQWNFLElBQWQsQ0FBbUIsR0FBbkIsQ0FBVDtBQUNIO0FBQ0osU0FKRDs7QUFNQSxlQUFPTixJQUFJTSxJQUFKLENBQVMsR0FBVCxDQUFQO0FBQ0g7O0FBRUQsYUFBU0MsWUFBVCxDQUFzQlIsR0FB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QUNoQnlCLDBDQUFNekMsTUFBTjtBQUNILGlDQUZELE1BRU87QUFDSGhELDZDQUFTZ0QsTUFBVDtBQUNIO0FBQ0osNkJBTkQsRUFNRyxHQU5IO0FBT0g7QUFDSixxQkFqQkQ7QUFrQkg7QUFDSjtBQUNKO0FBaFFFLEtBQVA7QUFrUUgsQ0F0VGUsQ0FzVGRnRCxNQXRUYyxDQUFoQiIsImZpbGUiOiJtb2R1bGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBNb2R1bGUgPSAoZnVuY3Rpb24oJCkge1xuICAgIFxuICAgIGZ1bmN0aW9uIF9nZXRVcmwoKSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0ge307XG5cbiAgICAgICAgcXVlcnkuc3BsaXQoXCImXCIpLmZvckVhY2goZnVuY3Rpb24ocGFydCkge1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHBhcnQuc3BsaXQoXCI9XCIpO1xuICAgICAgICAgICAgcmVzdWx0W2l0ZW1bMF1dID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0ZW1bMV0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9zZXRVcmwobmFtZSwgcGFyYW1ldGVyKSB7XG4gICAgICAgIGNvbnN0IF91cmwgPSBfZ2V0VXJsKCk7XG5cbiAgICAgICAgX3VybFtuYW1lXSA9IHBhcmFtZXRlcjtcblxuICAgICAgICByZXR1cm4gX3VybDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfam9pblVybChnZXQpIHtcbiAgICAgICAgY29uc3QgdXJsID0gW107XG5cbiAgICAgICAgT2JqZWN0LmtleXMoZ2V0KS5tYXAoaWQgPT4ge1xuICAgICAgICAgICAgaWYgKGdldFtpZF0gIT09ICd1bmRlZmluZWQnICYmIGdldFtpZF0gIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdXJsLnB1c2goW2lkLCBnZXRbaWRdXS5qb2luKCc9JykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdXJsLmpvaW4oJyYnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfcmVkaXJlY3RVcmwoZ2V0KSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhnZXQpLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IHVybCA9ICcnO1xuXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhnZXQpLm1hcChpZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlkICE9PSAncGFnZScgJiYgZ2V0W2lkXSAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2V0W2lkXSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSAnJidcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHVybCArPSBbaWQsIGdldFtpZF1dLmpvaW4oJz0nKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGxvY2F0aW9uLnNlYXJjaCA9IHVybFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBjaGFuZ2VGaWxlTmFtZTogZnVuY3Rpb24oaWQsIHRpdGxlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZWQnLCBpZCwgdGl0bGUpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mKGlkKSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mKHRpdGxlKSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHByb21wdCgn0JLQstC10LTQuNGC0LUg0L3QvtCy0L7QtSDQuNC80Y8nLCB0aXRsZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAobmFtZSAhPT0gJycgJiYgbmFtZSAhPT0gdGl0bGUgJiYgbmFtZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBgLyR7QURNSU5fRElSfS9tZXRhL2ZpbGVuYW1lYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBhamF4RmlsZURlbGV0ZTogZnVuY3Rpb24oaWQsIG9iaikge1xuICAgICAgICAgICAgaWYgKGNwLmRpYWxvZyhcItCS0Ysg0LTQtdC50YHQstC40YLQtdC70YzQvdC+INGF0L7RgtC40YLQtSDRg9C00LDQu9C40YLRjCDRhNCw0LnQuz9cIikpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycgKyBBRE1JTl9ESVIgKyAnL21ldGEvZmlsZWRlbGV0ZScsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdFwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdKU09OJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjJytvYmopLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBzb3J0IChuYW1lKVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBfZ2V0ID0gX2dldFVybCgpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIF9nZXQuc29ydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IF9nZXQuc29ydC5zcGxpdCgnLScpWzFdO1xuICAgICAgICAgICAgICAgIHR5cGUgPSAodHlwZSA9PT0gJ2FzYycpID8gJ2Rlc2MnIDogJ2FzYyc7XG4gICAgICAgICAgICAgICAgbG9jYXRpb24uc2VhcmNoID0gX2pvaW5VcmwoX3NldFVybCgnc29ydCcsIG5hbWUgKyAnLScgKyB0eXBlKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnNlYXJjaCA9IF9qb2luVXJsKF9zZXRVcmwoJ3NvcnQnLCBuYW1lICsgJy1hc2MnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VhcmNoIChuYW1lLCB2YWx1ZSwgYmluZCwgZSlcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKGJpbmQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgIF9yZWRpcmVjdFVybChfc2V0VXJsKG5hbWUsIHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfcmVkaXJlY3RVcmwoX3NldFVybChuYW1lLCB2YWx1ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbG9hZCAoKVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBfZ2V0ID0gX2dldFVybCgpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIF9nZXQucGFnZSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJldiA9IChfZ2V0LnBhZ2UgLSAxKSA+PSAwID8gKF9nZXQucGFnZSAtIDEpIDogJyc7XG5cbiAgICAgICAgICAgICAgICBpZiAocHJldikge1xuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5zZWFyY2ggPSAncGFnZT0nK3ByZXY7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXRTb3J0IChlbGVtZW50LCBpZCwgZmllbGQpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBbJ21vZHVsZScsICdzb3J0ZWQnLCBpZF0uam9pbignXycpO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbGVtZW50LnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSAkLmNvb2tpZShuYW1lKTtcblxuICAgICAgICAgICAgaWYgKGNhY2hlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHNvcnQgPSBbXTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gdW5zZXJpYWxpemUoY2FjaGUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBbaWRdID09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRbaWRdID0ge307XG4gICAgICAgICAgICAgICAgICAgIHNvcnRbaWRdW2ZpZWxkXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2lkXVtmaWVsZF0gPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbaWRdW2ZpZWxkXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFtpZF1bZmllbGRdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzb3J0ID0gdGVtcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkLnJlbW92ZUNvb2tpZShuYW1lKTtcbiAgICAgICAgICAgICAgICAkLmNvb2tpZShuYW1lLCBzZXJpYWxpemUoc29ydCksIHsgZXhwaXJlczogMzAsIHBhdGg6ICcvJyB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzb3J0ID0gW107XG5cbiAgICAgICAgICAgICAgICBzb3J0W2lkXSA9IHt9O1xuICAgICAgICAgICAgICAgIHNvcnRbaWRdW2ZpZWxkXSA9IHZhbHVlO1xuXG4gICAgICAgICAgICAgICAgJC5jb29raWUobmFtZSwgc2VyaWFsaXplKHNvcnQpLCB7IGV4cGlyZXM6IDMwLCBwYXRoOiAnLycgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldExpbWl0IChlbGVtZW50LCBpZClcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IFsnbW9kdWxlJywgJ2xpbWl0JywgaWRdLmpvaW4oJ18nKTtcbiAgICAgICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQoZWxlbWVudC52YWx1ZSk7XG5cbiAgICAgICAgICAgICQucmVtb3ZlQ29va2llKG5hbWUpO1xuICAgICAgICAgICAgJC5jb29raWUobmFtZSwgbGltaXQsIHsgZXhwaXJlczogMzAsIHBhdGg6ICcvJyB9KTtcblxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlIChlLCBuYW1lLCBpZClcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBOdW1iZXIoZS50YXJnZXQuY2hlY2tlZCk7XG5cbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiBbJy8nLCBBRE1JTl9ESVIsICcvc2hvcHBpbmcvdXBkYXRlJ10uam9pbignJyksXG4gICAgICAgICAgICAgICAgdHlwZTogXCJwb3N0XCIsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdKU09OJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja0FsbCAoZWxlbWVudClcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgY2hlY2tlZCA9ICQoZWxlbWVudCkucHJvcCgnY2hlY2tlZCcpO1xuICAgICAgICAgICAgJCgnLmNoZWNrLWFsbC1zcHknKS5wcm9wKCdjaGVja2VkJywgY2hlY2tlZCk7XG5cbiAgICAgICAgICAgIGlmIChjaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgJCgnI3JlbW92ZS1idXR0b24nKS5hZGRDbGFzcygnZW5hYmxlJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJyNyZW1vdmUtYnV0dG9uJykucmVtb3ZlQ2xhc3MoJ2VuYWJsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrSXRlbSAoZWxlbWVudClcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKCQoJy5jaGVjay1hbGwtc3B5OmNoZWNrZWQnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkKCcjcmVtb3ZlLWJ1dHRvbicpLmFkZENsYXNzKCdlbmFibGUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnI3JlbW92ZS1idXR0b24nKS5yZW1vdmVDbGFzcygnZW5hYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsZXRlUXVlc3Rpb24gKGUsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgY29uc3QgaXNEZWxldGUgPSBjcC5kaWFsb2coJ9CS0Ysg0LTQtdC50YHRgtCy0LjRgtC10LvRjNC90L4g0YXQvtGC0LjRgtC1INGD0LTQsNC70LjRgtGMINC/0L7Qt9C40YbQuNGOPycpO1xuXG4gICAgICAgICAgICBpZiAoaXNEZWxldGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBfaHJlZiA9ICQoZWxlbWVudCkuYXR0cignaHJlZicpO1xuXG4gICAgICAgICAgICAgICAgJC5wb3N0KF9ocmVmLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNwLm5vdGlmeSgn0J/QvtC30LjRhtC40Y8g0YPQtNCw0LvQtdC90LAnLCAnaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmNsb3Nlc3QoJ3RyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZWxldGVJdGVtIChpZCwgbWlkLCBub3RpZnkpIHtcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiBgLyR7QURNSU5fRElSfS9tZXRhL21vZHVsZS9kZWwvJHttaWR9LyR7aWR9YCxcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RcIixcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlOiBtaWRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnSlNPTicsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gc3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI21vZHVsZS10YWJsZScpLmZpbmQoJy5tb2R1bGUtdGFibGVfX3Jvd1tkYXRhLWlkPVwiJyArIGlkICsgJ1wiXScpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChub3RpZnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwLm5vdGlmeSgn0J/QvtC30LjRhtC40Y8g0YPQtNCw0LvQtdC90LAnLCAnaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsZXRlQWxsIChlKVxuICAgICAgICB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gJCgnLmNoZWNrLWFsbC1zcHk6Y2hlY2tlZCcpLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGxpbWl0ID0gJCgnLmNoZWNrLWFsbC1zcHknKS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmIChjb3VudClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICBpZiAoY3AuZGlhbG9nKFsn0JLRiyDQtNC10LnRgdGC0LLQuNGC0LXQu9GM0L3QviDRhdC+0YLQuNGC0LUg0YPQtNCw0LvQuNGC0YwgJywgZGVjbE9mTnVtKGNvdW50LCBbJ9C/0L7Qt9C40YbQuNGPJywgJ9C/0L7Qt9C40YbQuNC5JywgJ9C/0L7Qt9C40YbQuNC4J10pLCAnPyddLmpvaW4oJycpKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5jaGVjay1hbGwtc3B5OmNoZWNrZWQnKS5lYWNoKChrLCBlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaXggPSAkKGVsZW1lbnQpLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG1wID0gbWl4LnNwbGl0KCdfJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRlbGV0ZUl0ZW0ocGFyc2VJbnQodG1wWzBdKSwgcGFyc2VJbnQodG1wWzFdKSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGsgKyAxKSA9PSBjb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwLm5vdGlmeShbJ9Cj0LTQsNC70LXQvdC+ICcsIGRlY2xPZk51bShjb3VudCwgWyfQv9C+0LfQuNGG0LjRjycsICfQv9C+0LfQuNGG0LjQuScsICfQv9C+0LfQuNGG0LjQuCddKV0uam9pbignJyksICdpbmZvJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IGxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufShqUXVlcnkpKTsiXX0=
