"use strict";var Module=function(e){function o(){var e={};return location.search.substr(1).split("&").forEach(function(o){var t=o.split("=");e[t[0]]=decodeURIComponent(t[1])}),e}function t(e,t){var a=o();return a[e]=t,a}function a(e){var o=[];return Object.keys(e).map(function(t){"undefined"!==e[t]&&""!==e[t]&&o.push([t,e[t]].join("="))}),o.join("&")}function n(e){if(Object.keys(e).length){var o="";Object.keys(e).map(function(t){"page"!==t&&"undefined"!==e[t]&&""!==e[t]&&(""!==o&&(o+="&"),o+=[t,e[t]].join("="))}),location.search=o}}return{changeFileName:function(o,t){if(console.log("ed",o,t),void 0!==o&&void 0!==t){var a=prompt("Введите новое имя",t);if(""!==a&&a!==t&&null!==a)return e.ajax({url:"/"+ADMIN_DIR+"/meta/filename",type:"POST",data:{id:o,name:a}}),a}return!1},ajaxFileDelete:function(o,t){return cp.dialog("Вы дейсвительно хотите удалить файл?")&&e.ajax({url:"/"+ADMIN_DIR+"/meta/filedelete",type:"post",data:{id:o},dataType:"JSON",success:function(o){console.log(o),!0===o.status&&e("#"+t).remove()}}),!1},sort:function(e){var n=o();if(void 0!==n.sort){var i=n.sort.split("-")[1];i="asc"===i?"desc":"asc",location.search=a(t("sort",e+"-"+i))}else location.search=a(t("sort",e+"-asc"))},search:function(e,o,a,i){a?13==i.keyCode&&n(t(e,o)):n(t(e,o))},reload:function(){var e=o();if(void 0!==e.page){var t=e.page-1>=0?e.page-1:"";t?location.search="page="+t:location.reload()}else location.reload()},setSort:function(o,t,a){var n=["module","sorted",t].join("_"),i=o.value,c=e.cookie(n);if(c){var l=[],r=unserialize(c);"undefined"==r[t]?(l[t]={},l[t][a]=i):(r[t][a],r[t][a]=i,l=r),e.removeCookie(n),e.cookie(n,serialize(l),{expires:30,path:"/"})}else{var s=[];s[t]={},s[t][a]=i,e.cookie(n,serialize(s),{expires:30,path:"/"})}setTimeout(function(){location.reload()},50)},setLimit:function(o,t){var a=["module","limit",t].join("_"),n=parseInt(o.value);e.removeCookie(a),e.cookie(a,n,{expires:30,path:"/"}),setTimeout(function(){location.reload()},50)},update:function(o,t,a){var n=Number(o.target.checked);e.ajax({url:["/",ADMIN_DIR,"/shopping/update"].join(""),type:"post",data:{id:a,name:t,value:n},dataType:"JSON",success:function(e){console.log("update")}})},checkAll:function(o){var t=e(o).prop("checked");e(".check-all-spy").prop("checked",t),t?e("#remove-button").addClass("enable"):e("#remove-button").removeClass("enable")},checkItem:function(o){e(".check-all-spy:checked").length?e("#remove-button").addClass("enable"):e("#remove-button").removeClass("enable")},deleteProduct:function(e,o){e.preventDefault(),cp.dialog("Вы действительно хотите удалить товар?")&&this.deleteItem(o,!0)},deleteItem:function(o,t){e.ajax({url:["/",ADMIN_DIR,"/shopping/delete"].join(""),type:"post",data:{id:o},dataType:"JSON",success:function(){e("#module-table").find('.module-table__row[data-id="'+o+'"]').remove(),t&&cp.notify("Товар удален","info")}})},deleteAll:function(o){o.preventDefault();var t=e(".check-all-spy:checked").length,a=e(".check-all-spy").length;if(t){var n=this;cp.dialog(["Вы действительно хотите удалить ",declOfNum(t,["товар","товара","товаров"]),"?"].join(""))&&e(".check-all-spy:checked").each(function(o,i){n.deleteItem(parseInt(e(i).val()),!1),o+1==t&&(cp.notify(["Удалено ",declOfNum(t,["товар","товара","товаров"])].join(""),"info"),setTimeout(function(){t==a?n.reload():location.reload()},150))})}}}}(jQuery);